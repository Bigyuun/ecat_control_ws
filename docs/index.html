<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EtherCAT Control Framework: Welcome to Veysi ADIN &amp; Chunwoo Kim&#39;s ROS2 EtherCAT package.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="symbol.webp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EtherCAT Control Framework<span id="projectnumber">&#160;v0.9</span>
   </div>
   <div id="projectbrief">Implementation of EtherCAT protocol using IgH EtherCAT library for robot controller.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Welcome to Veysi ADIN &amp; Chunwoo Kim's ROS2 EtherCAT package. </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> This repository contains ROS2 and EtherCAT based control framework for our spine surgery robot project, but this implementation can be used with any robotic system with small modifications. Contains EtherCAT real-time thread with priority of 98. Software consists of four components (ROS2 nodes) :</p>
<p ><b>• EtherCAT node:</b> Responsible for EtherCAT communication between master and slaves and publishes acquired feedback from slaves under /slave_feedback topic name in 1 kHz frequency. Additionally, subscribes to /controller topic, published from the control input node, / gui_buttons topic published from the <a class="el" href="namespaceGUI.html">GUI</a> node, and /safety_info topic published from the safety node. Calculates target values for each motor and sends control commands to slaves via EtherCAT communication and publishes those values under the /master_commands topic.</p>
<p ><b>• Control node:</b> Acquires input data from the input device and in the current setup input device is the Xbox controller. Therefore, it gets axis data and button data from the Xbox controller and publishes it under the /controller topic. Additionally, this node subscribes to the /slave_feedback topic published from the EtherCAT node.</p>
<p ><b>• <a class="el" href="namespaceGUI.html">GUI</a> node:</b> Consists of camera viewer and slave feedback visualizers such as motor state, communication state, and emergency button state. Publishes under /gui_buttons data consists of soft button events, subscribes to /master_ commands, and /slave_feedback, and /safety info topics to give visual feedback to the user. Control user interface buttons activated based on lifecycle node state.</p>
<p ><b>• Safety node:</b> Subscribes to all published topics and checks the consistency in the system, decides about the state of the system. System-related safety information is checked every cycle. Manages lifecycle node and state transitions are triggered from this node.</p>
<p >Published and subscribed topics for each node are shown in figure below,</p>
<p ><img src="https://raw.githubusercontent.com/veysiadn/ecat_control_ws/master/docs/img/node_pu_sub_topics.jpg" alt="Nodes Published and Subscribed Topics" class="inline"/></p>
<p >and the contents of the topics are shown in figure below.</p>
<p ><img src="https://raw.githubusercontent.com/veysiadn/ecat_control_ws/master/docs/img/topic_msgs.jpg" alt="Topics and contained messages" class="inline"/></p>
<p >Note that published topic messages can be changed by changing msg file contents in case custom message is required.</p>
<h3><a class="anchor" id="autotoc_md1"></a>
Please check guides, links and documentations before installation, or using this control framework.</h3>
<h1><a class="anchor" id="autotoc_md2"></a>
Guides</h1>
<ul>
<li><a href="https://docs.ros.org/en/foxy/index.html">ROS2</a></li>
<li><a href="https://design.ros2.org/articles/node_lifecycle.html">ROS2 Life-cycle Node</a></li>
<li><a href="https://design.ros2.org/articles/ros_on_dds.html">ROS2 DDS</a></li>
<li><a href="https://design.ros2.org/articles/qos_deadline_liveliness_lifespan.html">ROS2 QoS</a></li>
<li><a href="https://www.ethercat.org/en/technology.html">EtherCAT</a></li>
<li><a href="https://www.etherlab.org/en/ethercat/index.php">Etherlab Webpage</a></li>
<li><a href="https://www.etherlab.org/download/ethercat/ethercat-1.5.2.pdf">IgH EtherCAT Library Documentation</a></li>
<li><a href="https://wiki.linuxfoundation.org/realtime/documentation/technical_basics/start">Real-time Linux</a></li>
<li><a href="https://design.ros2.org/articles/realtime_background.html">ROS2 Real-time Background</a></li>
<li><a href="https://www.ripublication.com/ijaer17/ijaerv12n21_94.pdf">Article on EtherCAT-RT PREEMPT- Xenomai</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Prerequisites</h1>
<ul>
<li><a href="https://github.com/veysiadn/IgHEtherCATImplementation">IgH EtherCAT</a></li>
<li><a href="https://github.com/veysiadn/RT_PREEMPT_INSTALL">RT_Preempt Linux</a></li>
<li>If you want to use <a href="https://github.com/veysiadn/xenomai-install">Xenomai-Instalattion</a></li>
<li><a href="https://docs.ros.org/en/foxy/Installation/Ubuntu-Install-Debians.html">ROS2 Foxy Installation</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Building and running</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
Building</h2>
<div class="fragment"><div class="line">git clone https://github.com/veysiadn/ecat_control_ws</div>
<div class="line">source /opt/ros/foxy/setup.bash</div>
<div class="line">cd ecat_control_ws</div>
<div class="line">colcon build --symlink-install</div>
</div><!-- fragment --><p> Note that, before running, you might need to change lauch_all_nodes.py file, to isolate specific CPU core in your system. </p>
<h3><a class="anchor" id="autotoc_md6"></a>
Running</h3>
<div class="fragment"><div class="line">sudo -s</div>
<div class="line">source /opt/ros/foxy/setup.bash</div>
<div class="line">. install/setup.bash</div>
<div class="line">ros2 launch launch_all_nodes.py</div>
</div><!-- fragment --> <h4><a class="anchor" id="autotoc_md7"></a>
Note that, two launch files are provided. In launch_all_nodes.py file, state transitions are requested by pressing buttons in GUI node, and Safety Node changes state for the EtherCAT node. In other launch file, ethercat_nodes_launch.py file, state transitions directly triggered in the python script, and in the current version, it brings the EtherCAT node to the active state.</h4>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
